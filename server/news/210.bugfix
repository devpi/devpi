fix #210: the original fix was incomplete and the test for it was subtly wrong.